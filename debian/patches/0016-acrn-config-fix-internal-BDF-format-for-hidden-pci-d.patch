From: Helmut Buchsbaum <helmut.buchsbaum@opensource.tttech-industrial.com>
Date: Thu, 2 Jul 2020 16:14:50 +0200
Subject: acrn-config: fix internal BDF format for hidden pci devices

Signed-off-by: Helmut Buchsbaum <helmut.buchsbaum@opensource.tttech-industrial.com>
---
 misc/acrn-config/board_config/board_c.py  | 4 ++--
 misc/acrn-config/library/board_cfg_lib.py | 4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/misc/acrn-config/board_config/board_c.py b/misc/acrn-config/board_config/board_c.py
index 00f2439..dbe55c1 100644
--- a/misc/acrn-config/board_config/board_c.py
+++ b/misc/acrn-config/board_config/board_c.py
@@ -248,8 +248,8 @@ def gen_pci_hide(config):
         print("const union pci_bdf plat_hidden_pdevs[MAX_HIDDEN_PDEVS_NUM] = {", file=config)
         for hidden_pdev_i in range(hidden_pdev_num):
             bus = hex(int(hidden_pdev_list[hidden_pdev_i].split(':')[0], 16))
-            dev = hex(int(hidden_pdev_list[hidden_pdev_i].split(':')[1], 16))
-            fun = hex(int(hidden_pdev_list[hidden_pdev_i].split(':')[2], 16))
+            dev = hex(int(hidden_pdev_list[hidden_pdev_i].split(':')[1].split('.')[0], 16))
+            fun = hex(int(hidden_pdev_list[hidden_pdev_i].split(':')[1].split('.')[1], 16))
             print("\t{", file=config)
             print("\t\t.bits.b = {}U,".format(bus), file=config)
             print("\t\t.bits.d = {}U,".format(dev), file=config)
diff --git a/misc/acrn-config/library/board_cfg_lib.py b/misc/acrn-config/library/board_cfg_lib.py
index 405f900..3052ba1 100644
--- a/misc/acrn-config/library/board_cfg_lib.py
+++ b/misc/acrn-config/library/board_cfg_lib.py
@@ -26,8 +26,8 @@ HEADER_LICENSE = common.open_license() + "\n"
 
 # The data base contains hide pci device
 KNOWN_HIDDEN_PDEVS_BOARD_DB = {
-    'apl-mrb':['00:0d:0'],
-    'apl-up2':['00:0d:0'],
+    'apl-mrb':['00:0d.0'],
+    'apl-up2':['00:0d.0'],
 }
 
 def get_info(board_info, msg_s, msg_e):
